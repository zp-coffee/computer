# 计算机网络体系架构

## 计算机网络概述

### 概述

*   **计算机网络**是一个将**分散的，具有独立功能**的计算机系统，通过**通信设备**与**线路**连接起来，由**功能完善的软件**实现**资源共享**和**信息传递**的系统

*   **客户机**是客户访问网络的出入口
*   **服务器**是提供服务，存储信息的设备
*   **中继器和桥接器**通常是用于局域网的物理层和数据链路层的联网设备
*   目前局域网接入广域网主要是通过**路由器**这种互联设备来实现的

*   ARPAnet是最早的计算机网络，是因特网(Internet)的前身



### 计算机网络的组成

*   **从组成部分上看：**
    *   硬件
        *   主机(端系统)，通信链路(双绞线，光纤)，交换设备(路由器，交换机)，通信处理机(网卡)
    *   软件
        *   各种实现资源共享的软件和方便用户使用的各种工具软件(网络操作系统，邮件收发程序，FTP程序，聊天软件)，软件多属于应用层
    *   协议
        *   计算机网络的核心，协议规定了网络传输数据时所遵循的规范
*   **从工作方式上看：**
    *   边缘部分(计算机实体，身体各部分)
        *   所有连接到因特网上，供用户直接使用的主机组成，用来进行通信和资源共享
    *   核心部分(计算机之间的连接器，大脑)
        *   大量的网络和连接这些网络的路由器组成，为边缘部分提供连通性和交换服务

*   **从逻辑功能组成上看：**
    *   通信子网(传输介质，通信设备，协议)
        *   各种传输介质，通信设备和相应的网络协议，使网络具有数据传输，交换，控制和存储的能力，实现联网计算机之间的数据通信
        *   网桥，交换机，路由器
        *   对应OSI参考模型下三层：物理层，数据链路层，网络层
    *   资源子网(资源共享，软件，设备)
        *   实现资源共享功能的设备及其软件的集合，向网络用户提供共享其他计算机上的硬件资源，软件资源和数据资源的服务
        *   资源子网主要由计算机系统，终端，联网外部设备，各种软件资源和信息资源等组成
        *   计算机软件



### 计算机网络的功能

*   **数据通信**
    *   计算机网络的**最基本，最重要**的功能，用来实现联网计算机之间各种信息的传输，并将分散在不同地理位置的计算机联系起来，进行统一的调配，控制和管理
*   **资源共享**
    *   软件共享，硬件共享，数据共享，使计算机网络中的资源互通有无，分工协作，极大地提高硬件资源，软件资源，数据资源的利用率
*   **分布式处理**
    *   将处理的某个复杂任务分配给网络中的其他计算机系统，从而利用空闲计算机资源来提高整个系统的利用率
*   **提高可靠性**
    *   计算机网络中的各台计算机可以通过网络互为替代机
*   **负载均衡**
    *   将工作任务均衡地分配给计算机网络中的各台计算机



### 计算机网络的分类

*   **按分布范围：**
    *   广域网(WAN)
        *   提供长距离通信，是因特网的核心部分，连接广域网的各结点交换机的链路一般都是高速链路，具有较大的通信容量，采用交换技术
    *   城域网(MAN)
        *   采用以太网技术
    *   局域网(LAN)
        *   使用广播技术，局域网工作在数据链路层
    *   个人区域网(PAN)
        *   指在个人工作的地方将消费电子设备用**无线技术**连接起来的网络，也称无线个人局域网



*   **按传输技术：**
    *   广播式网络
        *   局域网，广域网中的无线，卫星通信网络
    *   点对点网络
    *   是否采用**分组存储转发**和**路由选择机制**是点对点式网络与广播式网络的重要区别，广域网基本都属于点对点网络



*   **按拓扑结构：**

    *   网络拓扑结构是指网中结点(主机，路由器)与通信线路(网线)之间的几何关系表示的网络结构，主要指**通信子网**的拓扑结构

    

    *   总线形网络(多用于局域网)

        *   优点：建网容易，增/减结点方便，节省线路

        *   缺点：重负载时通信效率不高，总线任意一处对故障敏感

            ![img](/Users/coffeeboy/Desktop/考研/assets/70.gif)

    *   星形网络(多用于局域网)

        *   优点：便于集中控制和管理

        *   缺点：成本高，中央设备对故障敏感

            ![img](/Users/coffeeboy/Desktop/考研/assets/70-20231011165038047.gif)

    *   环形网络(多用于局域网)

        *   令牌环局域网，环中信号是单向传输的，多用于局域网

            ![img](/Users/coffeeboy/Desktop/考研/assets/70-20231011165200205.gif)

    *   网状网络(多用于广域网)

        *   有规则型和非规则型

        *   优点：可靠性高

        *   缺点：控制复杂，线路成本高

            ![img](/Users/coffeeboy/Desktop/考研/assets/70-20231011165324810.gif)



*   **按使用者分类：**
    *   公用网
        *   电信公司出资建造的大型网络
    *   专用网
        *   某个部门为了满足本单位特殊业务建造的网络，比如铁路，电力，军队等部门的专用网



*   **按交换技术分类：**
    *   交换技术是指**各台主机之间，各通信设备之间或主机与通信设备之间**为**交换信息所采用的数据格式和交换装置**的方式
    *   电路交换网络
        *   在源结点和目的结点之间建立一条专用的线路，会独占资源，比如电话通信
        *   优点：数据直接传送，时延小
        *   缺点：线路利用率低，不能充分利用线路容量，不便于进行差错控制
    *   报文交换网络
        *   将用户数据封装成报文，可以单独选择到达目的结点的路径，采用存储，转发机制，不独占资源
        *   优点：
            *   充分地利用线路容量
            *   实现不同链路之间不同数据传输速率的转换
            *   实现格式转换
            *   实现一对多，多对一的访问
            *   实现差错控制
        *   缺点：
            *   增大了资源开销
            *   增加了缓冲时延
            *   需要额外的控制机制来保证多个报文的顺序不乱序
            *   缓冲区难以管理
    *   分组交换网络
        *   将数据分成固定长度的数据块，采用报文交换网络的传输方式进行传输
        *   优点：
            *   报文网络的优点
            *   缓冲易于管理
            *   包的平均时延更小
            *   网络占用的平均缓冲区更少
            *   更易于标准化
            *   更适合应用



*   **按传输介质分类：**
    *   无线网络
        *   蓝牙，微波，无线电
    *   有线网络
        *   双绞线网络
        *   同轴电缆网络



### 计算机网络的性能指标

*   **带宽：**网络的通信线路所能传送数据的能力，单位比特/秒 (b/s)
*   **时延：**数据从网络的一端传送到另一端所需的总时间
    *   发送时延
        *   数据从发送端到线路上的时间：发送时延=分组长度/信道宽度
    *   传播时延
        *   数据在线路上传输的时间：传播时延=信道长度/电磁波在信道上的传播速率，传播时延取决于传播介质以及收发双方的距离
    *   处理时延
        *   数据到达结点进行处理的时间
    *   排队时延
        *   数据进入路由器后在输入队列排队等待处理的时间
*   **时延带宽积：**发送端发送的第一个比特即将到达终点时，发送端已经发出了多少个比特
    *   时延带宽积=传播时延*信道带宽
*   **往返时延：**从发送端发出一个短分组，到发送端接收到接受端到确认的总时间
*   **吞吐量：**单位时间内通过某个网络的数据量
*   **速率：**连接到计算机网络上的主机在**数字信道**上传送数据的速率，也称**数据传输速率，数据率，比特率**，通常把最高数据传输速率称为带宽
*   **信道利用率：**某一信道有百分之多少时间是有数据通过的，信道利用率=有数据通过时间/总时间



*   总时延=发送时延+传播时延+处理时延+排队时延
*   对于高速链路，提高的仅是数据发送速率而非比特在链路上的传输速率，提高数据的发送速率只是为了减少数据的发送时延

![assets-20231011193027388](/Users/coffeeboy/Desktop/考研/assets/image-20231011193027388.png)



## 计算机网络体系结构与参考模型

### 计算机网络分层结构

*   **目的：**为了降低协议设计和调试过程的复杂性，为了便于对网络进行研究，实现和维护，促进标准化工作，所以对计算机网络的体系结构进行分层建模
*   **体系结构：**计算机网络的各层及其协议的集合
*   **分层的基本原则：**
    *   每层都实现一种相对独立的功能，降低大系统的复杂度——**(独立的功能)**
    *   各层之间界面自然清晰，易于理解，相互交流尽可能少——**(界面清晰)**
    *   各层功能的精确定义独立于具体的实现方法，可以采用最合适的技术来实现——**(实现方法独立)**
    *   保持下层对上层的独立性，上层单向使用下层提供的服务——**(上下层独立)**
    *   整个分层结构应能促进标准化工作——**(每层都促进标准化工作)**
*   第n层中的活动元素通常称为第n层实体，**实体：**任何可发送或接收信息的硬件或软件进程，通常是一个特定的软件模块
*   不同机器上的同一层称为**对等层**，同一层的实体称为**对等实体**
*   每层的报文分为2个部分：服务数据单元SDU，协议控制信息PCI，SDU+PCI=PDU(协议数据单元)
*   每一层传送的数据单元的名称，大小，含义都不同：
    *   物理层的PDU称为**比特**
    *   数据链路层的PDU称为**帧**
    *   网络层的PDU称为**分组**
    *   传输层的PDU称为**报文段**
*   **层次结构的含义：**
    *   上层要使用下层的服务来完成本层的功能，再向更上层提供服务
    *   最底层只提供服务，是整个层次结构的基础，最高层向用户提供服务
    *   上层只能通过相邻层之间的接口来使用下层的服务，下层提供的服务的实现细节对上层透明
    *   两台主机通信时，对等层在逻辑上有一条直接信道，能不经过下层直接将信息发送到对方



### 协议，接口，服务

*   **协议：**
    *   **协议：**规则的集合
    *   **网络协议：**为进行网络中的数据交换而建立的规则，标准或约定，控制**对等实体**进行通信的规则的集合，简称协议
    *   协议由**语法，语义，同步**三部分组成：
        *   **语法：**规定了传输数据的格式（格式）
        *   **语义：**规定了所要完成的功能，即需要发出何种控制信息，完成何种动作及做出何种应答（数据）
        *   **同步：**规定了执行各种操作的条件，时序关系，即事件实现顺序的详细说明（顺序）
    *   一个完整的协议应具有**线路管理，差错控制，数据转换**的功能
*   **接口：**
    *   **接口：**是同一结点内**相邻两层间**的交换信息的连接点，是一个系统内部的规定
    *   同一结点相邻两层的实体通过**服务访问点SAP**进行交互
*   **服务：**
    *   **服务：**下层为紧邻的上层提供的功能调用
    *   上层使用下层所提供的服务时必须与下层交换一些命令，这些命令在OSI模型中称为**服务原语**
    *   OSI参考模型将原语分为四类：
        *   请求（requset）：由上层发往下层，请求完成某项工作
        *   响应（response）：由上层发往下层，作为对指示的响应
        *   指示（indication）：由下层发往上层，指示上层做某件事情
        *   证实（confirmation）：由下层发往上层，作为对请求的证实
    *   有应答服务包括全部4类原语，无应答服务只包含请求和指示
    *   只有本层协议的实现才能保证向上一层提供服务
    *   并非在一层内完成的所有功能都叫做服务，只有能够被上一层实体看得见的才称为服务
    *   计算机网络提供的服务按以下三种方式分类：
        *   **面向连接服务和无连接服务**
            *   面向连接服务：通信前双方必须建立连接，分配相应的资源(如缓冲区)，传输结束后释放连接和所占用的资源，可以分为连接建立，数据传输，连接放三个阶段，比如TCP
            *   无连接服务：通信前双方不需要建立连接，发送数据时直接发送，把每个带有目的地址的包传送线路上，这是一种不可靠的服务，比如IP，UDP
        *   **可靠服务和不可靠服务**
            *   可靠服务：指网络具有纠错，检错，应答机制，能保证数据正确，可靠地传送到目的地
            *   不可靠服务：指网络只是尽量正确，可靠地传送，而不能保证数据正确，可靠地传送到目的地，是一种尽力而为的服务
        *   **有应答服务和无应答服务**
            *   有应答服务：指接收方在收到数据后向发送方给出相应的回答，比如文件传输服务
            *   无应答服务：指接收方收到数据后不自动给出应答，若需要应答由高层实现，比如WWW服务



### ISO/OSI参考模型和TCP/IP模型

#### OSI参考模型

*   **OSI参考模型：**ISO提出的网络体系结构模型，称为**开放系统互连参考模型(OSI/RM)**
*   OSI一共有7层：物理层，数据链路层，网络层，传输层，会话层，表示层，应用层
*   低三层：物理层，数据链路层，网络层统称为**通信子网**，为了联网而附加的通信设备，完成数据的传输功能
*   高三层：会话层，表示层，应用层统称为**资源子网**，相当于计算机系统，完成数据的处理
*   传输层承上启下
*   **分别说明各层的功能：**
    *   **物理层：**（底层设备）
        *   传输单位：比特
        *   功能：在物理媒体上为数据端设备透明地传输原始比特流
        *   物理层主要定义**数据终端设备(DTE)**和**数据通信设备(DCE)**的物理与逻辑连接方法
        *   物理层的接口标准很多，比如：EIA-232C，EIA/TIA，RS-449，CCITT的X.21
        *   物理层的主要研究内容：
            *   通信链路与通信结点的连接需要一些电路接口，物理层规定了这些接口的一些参数，如：机械形状，尺寸，交换电路的数量和排列
            *   物理层也规定了通信链路上传输的信号的意义和电气特征
        *   传输信号所利用的物理媒体，如双绞线，光缆，无线信道并不在物理层协议之内
    *   **数据链路层：**（点到点的线路）
        *   传输单位：帧
        *   功能：将网络层传来的IP数据报组装**成帧（成帧），差错控制，流量控制，传输管理**
            *   差错控制：检测数据传输中的错误，将错误信息丢弃
            *   流量控制：协调两个结点之间的速率
        *   广播式网络在数据链路层还需要处理**如何控制对共享信道的访问**，数据链路层中的子层：介质访问子层就是来处理这个问题
        *   典型的数据链路层协议：SDLC，HDLC，PPP，STP和帧中断
    *   **网络层：**（主机到主机）
        *   传输单位：数据报(分组)
        *   功能：通信子网的运行控制，把网络层的协议数据单元(分组)从源端传到目的端，为分组交换网上的不同主机提供通信服务，主要问题是对分组进行**路由选择，实现差错控制，流量控制，拥塞控制，网际互联**
        *   拥塞控制：缓解一个结点来不及接收分组而要丢弃大量分组使网络处于拥塞的情况
        *   因特网由大量异构网络通过路由器相互连接起来，主要网络协议为**无连接的网际协议和许多路由选择协议**，也称网际层或IP层
        *   网络层的协议：IP，IPX，ICMP，IGMP，ARP，RARP，OSPF
    *   **传输层：**（端到端的线路）
        *   传输单位：报文段(TCP)或用户数据报(UDP)
        *   功能：负责**主机中两个进程之间的通信**，为端到端连接提供可靠的传输服务，为端到端连接提供**差错控制，流量控制，应答，分组排序，服务质量，数据传输管理等服务，复用和分用的功能**
        *   复用：指多个应用层进程可同时使用下面传输层的服务
        *   分用：指传输层把收到的信息分别交付给上面应用层中相应的进程
        *   数据链路层提供的是点到点的通信，传输层提供的是端到端的通信
        *   点到点指的是**主机到主机之间的通信**，一个点指一个硬件地址或IP地址，网络中参与通信的主机是通过硬件地址或IP地址标识
        *   端到端指的是运行在**不同主机内的两个进程之间的通信**，一个进程由一个端口来标识
        *   传输层的协议：TCP，UDP
    *   **会话层：**（管理会话，同步）
        *   会话层允许不同主机上的各个进程之间进行会话
        *   会话层利用传输层提供的端到端的服务，向表示层提供他的增值服务，这种服务主要为**表示层实体或用户进程**建立连接并在连接上有序地传输数据，也称**建立同步**（SYN）
        *   会话层负责管理主机间的会话进程，包括建立，管理及终止进程间的会话
        *   会话层可以使用校验点使通信会话在通信失效时从校验点继续恢复通信，实现数据同步
    *   **表示层：**（表示方式转换）
        *   表示层主要处理两个通信系统中交换信息的表示方式
        *   采用抽象的标准方法定义数据结构，标准的编码形式，数据压缩
        *   ，加密和解密的方式来使不同表示方法的数据和信息之间能够进行交换
    *   **应用层：**（交互界面）
        *   OSI模型的最高层，是用户与网络的界面
        *   应用层为特定类型的网络应用提供访问OSI参考模型环境的手段
        *   应用层的协议：文件传送的FTP，电子邮件的SMTP，万维网的HTTP



#### TCP/IP参考模型

*   ARPA在研究APRAnet时提出了**TCP/IP**模型
*   TCP/IP模型一共有四层：网络接口层，网际层，传输层，应用层
*   **网络接口层：**（与物理网络的接口）
    *   功能类似于OSI的**物理层和数据链路层**
    *   作用：从主机或结点接收IP分组，并将他们发送到指定的物理网络中
*   **网际层：**（主机到主机）
    *   功能类似于OSI的网络层
    *   网际层定义了标准的分组格式和协议，即IP，采用的IP协议是IPv4，下一版是IPv6
*   **传输层：**（应用到应用 或 进程到进程）
    *   功能类似于OSI中的传输层
    *   作用：使得发送端和目的端主机上的对等实体进行会话
    *   传输层主要使用以下两种协议：
        *   传输控制协议（TCP）：面向连接，数据传输的单位是报文段，能够提供可靠的交付
        *   用户数据报协议（UDP）：无连接，数据传输的单位是用户数据报，不能提供可靠的交付
*   **应用层：**（用户到用户）
    *   包含所有的高层协议，比如虚拟终端协议（Telnet），文件传输协议（FTP），域名解析服务（DNS），电子邮件协议（SMTP），超文本传输协议（HTTP）



#### OSI和TCP/IP模型的比较

*   **相似之处：**
    *   都采取分层的体系结构，将庞大且复杂的问题划分为若干较容易处理的，范围较小的问题
    *   都是基于独立的协议栈的概念
    *   都可以解决异构网络的互联，实现世界上不同厂家生产的计算机之间的通信
*   **差别：**
    *   OSI精确地定义了三个主要概念：服务，协议，接口，而TCP/IP在这三个概念上没有明确的区分
    *   OSI通用性良好，TCP/IP不会出现协议不能匹配模型的情况，但该模型不适合于其他任何非TCP/IP的协议栈
    *   对于多种异构网的互联问题，OSI在网络层中划分出一个子层来完成类似于TCP/IP模型中的IP的功能，TCP/IP将网际协议（IP）作为一个单独的重要层次
    *   OSI在**网络层支持无连接和面向连接的通信，但在传输层仅有面向连接的通信**，TCP/IP在**网际层仅有一种无连接的通信模式，但传输层支持无连接和面向连接两种模式**



### 习题

*   对网络模型进行分层的目标：
    *   提供标准语言
    *   定义标准界面
    *   增加功能之间的独立性
*   将用户数据分成一个个数据块传输的优点：
    *   减少延迟时间
    *   提供错误控制效率
    *   使多个应用更公平地使用共享通信介质
*   ISO设计出了OSI/RM参考模型，但是实际使用的是TCP/IP
*   **数据链路层**在不可靠的物理介质上提供可靠的传输
    *   作用有：物理寻址，成帧，流量控制，差错校验，数据重发
    *   功能有：链路连接的建立，拆除，分离，帧界定，帧同步，差错检测
*   **网络层**实现路由选择，流量控制，差错控制，拥塞控制，网际互联
*   **传输层**实现应答，分组排序，流量控制，差错控制，应答
*   **会话层**实现会话管理，同步，恢复通信
*   **表示层**实现数据解密和加密，压缩，格式转换
*   **网络层和表示层**为上层提交的数据加上首部，**数据链路层**为上层提交的数据加上首部和尾部
*   **数据链路层**在分组上增加源和目的物理地址，还有控制信息
*   **传输层**负责增加相应源和目的端口信息
*   **网络层**只增加PCI(协议控制信息)
*   **OSI**在网络层支持无连接和面向连接的通信，在传输层仅支持面向连接的通信
*   **TCP/IP**在网际层仅支持无连接的通信，在传输层支持无连接和面向连接的通信
*   只有**传输层及其以上各层**的通信才能称为**端到端**，**数据链路层及其以上各层**都有流量控制和差错控制功能
*   因特网应用到网络协议为采用**分组交换技术的TCP/IP协议**
*   服务访问点（SAP）是一个层次系统的上下层之间进行通信的接口
    *   物理层的SAP为**网卡接口**
    *   数据链路层的SAP为**MAC地址（网卡地址）**
    *   网络层的SAP为**IP地址（网络地址）**
    *   传输层的SAP为**端口号**
    *   应用层的SAP为**用户界面**
*   **集线器**是一个多端口的中继器，工作在**物理层**
*   **以太网交换机**是一个多端口的网桥，工作在**数据链路层**
*   **路由器**是**网络层**设备
*   数据链路层，网络层，传输层都具有**流量控制和差错控制**功能
    *   数据链路层是相邻结点之间的流量控制，网络层是整个网络中的流量控制，传输层是端到端的流量控制
*   **传输速率**是指主机在数字信道上发送数据的速率
*   **带宽**是指在计算机网络中数字信道所能传送的“最高数据传输速率”，常用来表示网络的通信线路传送数据的能力
*   **传播速率**时是指电磁波在信道中传播的速率



![image-20231018163425895](/Users/coffeeboy/Desktop/考研/assets/image-20231018163425895-7618069.png)



# 物理层

## 通信基础

### 物理层通信相关概念

*   **数据：**指传送信息的实体
*   **信号：**数据的电气或电磁表现，是数据在传输过程中的存在形式
*   **数据和信号的表现形式有：**
    *   连续变化的数据(信号)：模拟数据/模拟信号
    *   取值为有限个离散数值的数据(信号)：数字数据/数字信号
*   **数据的传输方式：**
    *   串行传输
    *   并行传输

*   **码元：**用来表示不同进制的一个固定时长的信号波形，代表不同离散数值的基本波形
*   **码元宽度：**码元波形的时长
*   1个码元可以携带多个bit

*   一个数据通信系统包含：信源，信道，信宿
    *   **信源：**产生和发送数据的源头
    *   **信道：**信号的传输媒介
    *   **信宿：**接受数据的终点
*   **信道**按照**传输信号形式**分为：
    *   模拟信道
    *   数字信道
*   **信道**按照**传输介质**分为：
    *   无线信道
    *   有线信道
*   **信道**按**信号**分为：
    *   基带信号：将数字信号1和0直接用两种不同的**电压**表示，送到数字信道上传输(基带传输)
        *   数字基带传输在信道中直接传输数字信号，且传输媒体的整个带宽都被基带信号占用，能双向地传输信息
        *   用数字信号对特定频率的载波进行调制，在**模拟信道上**传输调制后的**数字信号**，这种传输方式称为**频带传输**
    *   带宽信号：将基带信号进行调制后形成**频分复用模拟信号**，送到模拟信道上传输(宽带传输)
        *   借助频带传输，将信道进行**频分复用**，划分为2条互不相关的子信道，分别在子信道上同时进行频带传输，这就是**带宽传输**
*   **信道**的**极限容量**是信道的最高码元传输速率/极限信息传输速率



*   从通信双方信息的**交互方式**来看分为：
    *   单向通信
    *   半双工通信
    *   全双工通信



*   **速率/数据率：**指数据传输速率，表示单位时间内传输的数据量，用码元传输速率/信息传输速率来表示
    *   码元传输速率：也叫波特率，单位时间内传输码元的个数(脉冲个数/信号变化的次数)，单位Baud
    *   信息传输速率：也叫信息速率，比特率，单位时间内传输的二进制码元个数(比特数)，单位b/s



*   **带宽：**信号所具有的频带宽度，也用来表示网络中的通信线路所能传输数据的能力



### 奈氏定理和香农定理

*   **奈氏定理：**在理想低通(没有噪声，带宽有限)的信道中，为了避免码间串扰，**极限码元传输速率**为2W波特
    *   W：理想低通信道的带宽
    *   V：每个码元离散电平的数目
    *   理想低通信道下的极限数据传输速率 = $2Wlog_2V$
*   由奈氏定理得出：
    *   任何通道中码元传输速率数有上限的，如果超过，则会出现**码间串扰问题**
    *   信道的带宽越高，就可使用越高的速率进行码元的有效传输
    *   奈氏准则限制了**码元传输速率**但是没有限制**信息传输速率**，即**一个码元可以携带多少比特**没有规定



*   下面给出信息传输速率的极限：
*   **香农定理：**在带宽受限且有高斯白噪声干扰的信道下不产生误差的极限数据传输速率
    *   信道的极限数据传输速率 = $Wlog_2(1+S/N)$
    *   W：信道的带宽
    *   S/N：信噪比，信号与噪声的平均功率之比
    *   还有一种信噪比采用dB为单位：信噪比 = $10log_{10}(S/N)$
*   由香农定理得出：
    *   信道的带宽或信噪比越大，信息的极限传输速率越高
    *   只要信息的传输速率低于极限传输速率，就能找懂一种方式实现无差错的传输
    *   香农定理得出的是极限传输速率，实际能达到的传输速率要低不少



### 编码与调制

*   **编码：**将数据转变为数字信号(结果为数字信号)
*   **调制：**将数据转变为模拟信号(结果为模拟信号)



*   **数字数据编码为数字信号：**(编码，用数字发送器)
    *   在基本不改变数字数据信号频率的情况下，直接传输数字信号，一共有6种编码规则
    *   **归零编码(RZ)：**
        *   用高电平代表1，低电平代表0(或者相反)，每个时钟周期的中间均跳变到低电平(归零)
        *   优点：接受方根据归零调整时钟，提供了自同步机制
        *   缺点：归零需要占用一部分带宽，传输效率受到影响
    *   **非归零编码(NRZ)：**
        *   用高电平代表1，低电平代表0(或者相反)，一个周期全部用来表示数据(不归零)
        *   缺点：无法传递时钟信号，若想传输高速同步信号，则需要时钟线
    *   **反向非归零编码(NRZI)：**
        *   用信号的翻转代表0，信号保持不变代表1
        *   优点：翻转信号本身作为一种通知机制，能传输时钟信号，也不损失系统带宽
        *   应用：USB2.0
    *   **曼切斯特编码：**
        *   将一个码元分成两个相等的间隔，前一个间隔为高电平而后一个间隔为低电平代表1，0相反(或者互换)
        *   优点：有时钟信号，可用于同步，宽带是原始基带宽度的2倍
        *   应用：以太网
    *   **差分曼切斯特编码：**
        *   若码元为1，则前半个码元的电平与上一个码元的后半个码元的电平相同，0相反(或者互换)
        *   优点：有时钟信号，可实现自同步，抗干扰性较好
        *   应用：局域网
    *   **4B/5B编码：**
        *   将欲发送数据流的每4位作为一组，按照4B/5B编码规则将其转换成相应的5位码，5位码一共32种组合，用前面的16位表示数据，后面16位作为控制码(帧的开始和结束，线路的状态信息等)或保留

![编码](/Users/coffeeboy/Desktop/考研/assets/a2e51276773e46b8a98470d7ab8f94cc-7538950-7538952-7538964-7538972.png)

*   **数字数据调制为模拟信号：**(调制，用调制器)
    *   **幅移键控(ASK)：**通过改变载波信号的**振幅**来表示数字信号1和0，频率和相位都不改变，缺点：抗干扰能力差
    *   **频移键控(FSK)：**通过改变载波信号的**频率**来表示数字信号1和0，振幅和相位都不改变，优点：容易实现，抗干扰能力强，应用广泛
    *   **相移键控(PSK)：**通过改变载波信号的**相位**来表示数字信号1和0，频率和振幅都不改变，还分为：绝对调相，相对调相
    *   **正交振幅调制(QAM)：**在频率相同的前提下，将ASK和PSK结合起来，形成叠加信号，设波特率为B，采用m个相位，每个相位有n种振幅，则该QAM技术的数据传输速率$R = Blog_2{(mn)}$，单位b/s

![调制](/Users/coffeeboy/Desktop/考研/assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTg4Mzg5MA==,size_16,color_FFFFFF,t_70.png)

*   **模拟数据编码为数字信号：**(编码，用PCM编码器)
    *   **采样定理：**在通信领域，带宽是指信号最高频率和最低频率之差，单位为Hz，设原始信号中f为最大频率，那么**采样频率F必须大于或等于f的两倍才能保证采样后的数字信号完整**，采样定理也称**奈奎斯特定理**
    *   模拟数据编码为数字信号分为三步：采样，量化，编码
        *   **采样：**对模拟信号进行周期性扫描，把时间上连续的信号变成时间上离散的信号
        *   **量化：**把采样得到的电平幅值按照一定的分级标度转化为对应的数字值并取整数，采样和量化的实质是分割和转换
        *   **编码：**把量化的结果转换为与之对应的二进制编码



*   **模拟数据调制为模拟信号：**(调制，放大器调制器)
    *   **频分复用技术(FDM)：**为了实现传输的有效性，可能需要更高的频率，可以使用频分复用技术(FDM)，充分利用带宽资源
    *   应用：电话机和本地局交换机



### 交换技术

*   **电路交换：**在进行数据传输前，两个结点之间建立一条独占的链路，直到通信结束才释放，在数据传输的过程中，用户始终占用**端到端的固定传输带宽**，分为三个阶段：连接建立，数据传输，连接释放
    *   **优点：**
        *   通信时延小
        *   有序传输
        *   没有冲突：不同的通信双方有不同的信道
        *   适用范围广：能传模拟信号也能传数字信号
        *   实时性强
        *   控制简单
    *   **缺点：**
        *   建立连接时间长
        *   线路独占
        *   灵活性差
        *   难以规格化：电路交换时，数据直达，不同类型，不同规格，不同速率的终端很难相互进行通信，也不能进行差错控制



*   **报文交换：**数据交换的单位为报文，报文携带有**目标地址，源地址等信息**，在交换节点采用**存储转发**的传输方式
    *   **优点：**
        *   无建立时延
        *   动态分配线路：结点可自己选择最合适的线路
        *   提高线路可靠性：若某条传输路径发生故障，可重新选择一条
        *   提高线路利用率：不像电路交换固定占用一条线路，而是在不同的时间一段一段地部分占用
        *   提供多目标服务：一个报文可以同时发送给多个目的地址
    *   **缺点：**
        *   存在转发时延
        *   对报文的大小没有限制，要求网络结点有较大的缓存空间
    *   **应用：**
        *   早期的电报通信网
        *   现在使用较先进的分组交换



*   **分组交换：**解决报文交换中大报文传输的问题，采用**存储转发方式**，把大的数据块划分为合理的小数据块，再加上一些必要的控制信息，构成分组(Packet)
    *   **优点：**
        *   无建立时延
        *   提高线路利用率
        *   简化了存储管理：划分成了固定的分组
        *   加速传输：流水线形式
        *   减少了出错概率和重发数据量
    *   **缺点：**
        *   存在转发时延
        *   需要传输额外的信息量
        *   当分组交换采用**数据报服务**，可能出现失序，丢失，重复分组的情况，分组到达目的地要对分组进行排序
    *   **应用：**
        *   适合于计算机之间的突发式数据通信



*   要传输的数据量很大且传送时间远大于呼叫时间时，采用**电路交换**
*   端到端的通路由多段链路组成时，采用**分组交换**



### 分组交换的两种方式

*   分组交换根据其**通信子网向端点系统提供的服务可分为：**面向连接的虚电路方式和无连接的数据报方式(都由网络层提供)
*   **数据报方式：**在**端系统中实现的高层协议**先将发送的报文拆分为若干带有序号的数据单元，在**网络层**加上地址等控制信息后形成数据报分组(网络层的PDU)，**中间结点**存储分组找到最佳的路由后，尽快转发每个分组直到目的结点
    *   **特点：**
        *   不需要建立连接
        *   对故障的适应能力强
        *   存储转发的时延小，提高网络的吞吐量
        *   资源利用率高，不独占某条链路
        *   传输不保证可靠性，分组不一定按序到达
        *   分组包含发送端和接受端的完整地址
        *   存储转发中排队等待处理会带来时延
*   **虚电路方式：**分组发送前建立一条虚电路，分为三个阶段：虚电路建立，数据传输，虚电路释放
    *   **特点：**
        *   建立和拆除虚电路需要时间，但是适合**长时间，频繁的数据交换**
        *   虚电路的路由选择体现在连接建立阶段，建立之后就确定了传输路径
        *   虚电路提供了可靠的通信功能，分组有序到达目的地，能进行流量控制
        *   某个结点或链路发生故障那么所有经过该结点或链路的虚电路都将失效
        *   分组首部不包含目的地址，而是包含虚电路标识符，相对于数据报方式开销更小



*   **比较：**

|                    | 数据报方式                 | 虚电路方式                                         |
| ------------------ | -------------------------- | -------------------------------------------------- |
| 连接的建立         | 不需要                     | 需要                                               |
| 目的地址           | 每个分组在首部都有         | 仅在建立连接阶段使用，之后使用长度较短的虚电路序号 |
| 路由选择           | 每个分组独立地进行路由选择 | 属于同一条虚电路的分组按照同一路由转发             |
| 分组顺序           | 不保证有序到达             | 保证有序到达                                       |
| 可靠性             | 不可靠，可靠性由用户保证   | 可靠，由网络保证                                   |
| 故障适应性         | 适应能力强                 | 所有故障结点的虚电路都不能工作                     |
| 差错控制和流量控制 | 用户主机进行流量控制       | 可由分组交换网负责也可由用户主机负责               |



### 习题

*   一条可双向通信的电路往往包含两个信道，一条是发送信道，一条时接收信道，另外，多个通信用户共用通信电路时，每个用户在该通信电路上都会有一个信道

*   并行传输：距离短，速度快，所以在计算机内部通常使用并行传输

*   曼切斯特编码适合传输二进制数字信号

*   脉冲编码调制(PCM)，常用于使用数字信号编码模拟数据，比如声音

*   把基带信号直接传送到通信线路(数字信道)上的传输方式称为**基带传输**，把基带信号经过调制后送到模拟信道上的传输方式称为**频带传输**，如果调制成**频分复用**的模拟信号送到模拟信道上传输就是**带宽传输**

*   以太网采用**曼切斯特编码**，城域网中使用以太网，波特率是数据率(速率)的两倍

*   局域网中采用**差分曼切斯特编码**

*   报文交换中，在交换结点中需要较大的存储空间，报文经过中间结点的接收，存储和转发时间较长，不能用于实时通信应用环境(语音，视频)

*   电路交换实时性好，传输时延小，但是**不具备差错控制和存储数据**的能力，无法纠正传输过程中发生的数据差错，适合于交互式会话类通信

*   数据报方式也**不具备差错控制和流量控制的能力，也不保证分组按序到达**

*   分组交换的数据报方式通过高层协议如TCP的差错控制和流量控制来保证传输的可靠性和有序性

*   虚电路包括永久性虚电路和交换型虚电路，永久性虚电路是提前定义好的，不需要任何建立时间，交换型虚电路是临时性连接，需要建立时间

*   数据报服务，每个分组在传输过程中都必须携带源地址和目的地址

*   传输时间 = 排队时延 + 处理时延 + 传输时延 + 发送时延

    *   没有特殊说明的话 排队时延和处理时延都不考虑

    *   一个分组的发送时延 = 分组大小/传输速率

    *   对于分组交换，**总传输时间 = 最后一个分组从源地址发送完毕的时间 + 最后一个分组在链路上传输和等待的时间**，其中             最后一个分组从源地址发送完毕的时间 = 所有分组大小/传输速率

        最后一个分组在链路上传输和等待的时间 = 分组大小/传输速率 * (所有结点-1) + 一个结点的处理时延 * (所有结点-1) + 传播时延



![image-20231018165755480](/Users/coffeeboy/Desktop/考研/assets/image-20231018165755480-7619477.png)



## 物理层传输媒介(并不属于物理层)

### 传输介质

*   **传输介质：**也称传输媒体，是数据传输系统中**发送设备**与**接收设备**之间的**物理通路**
*   传输介质分为：导向传输介质，非导向传输介质
    *   导向传输介质：电磁波被导向沿着固体媒介(铜丝或光纤)传播
    *   非导向传输介质：空气，真空，海水



### 双绞线

*   **双绞线：**由两根采用一定规则**并排绞和**的，**相互绝缘**的**铜**导线组成
*   **绞和：**用来减少对相邻导线的电磁干扰
*   屏蔽双绞线(STP)：在双绞线的外面加上一层用金属丝编织成的屏蔽层，可以**进一步提高抗电磁干扰的能力**
*   非屏蔽双绞线(UTP)：外面不带屏蔽层的双绞线
*   **特点：**
    *   价格便宜，最常用的传输介质
    *   带宽取决于**铜线的粗细和传输的距离**
    *   模拟传输和数字传输都可以使用双绞线
    *   距离太远时，对于模拟传输，要用**放大器**放大衰减的信号
    *   距离太远时，对于数字传输，要用**中继器**将失真的信号整形



### 同轴电缆

*   **同轴电缆：**由内导体，绝缘层，网状编织屏蔽层，塑料外层构成
*   按照**特性阻抗数值的不同**分为：
    *   50$\Omega$同轴电缆：用于传送基带数字信号，也称基带同轴电缆，在局域网中应用广泛
    *   75$\Omega$同轴电缆：用于传送宽带信号，也称宽带同轴电缆，在有线电视系统中应用广泛
*   **特点：**
    *   价格比双绞线贵
    *   由于**外导体屏蔽层**，有良好的抗干扰特性，广泛用于传输较高速率的数据，传输距离更远



### 光纤

*   **光纤：**由纤芯，包层构成，光纤很细，用来传导光波，包层较纤芯有较低的折射率，用来对光波进行折射
*   **光纤通信：**利用光导纤维(光纤)传递光脉冲来进行通信
*   有光脉冲表示1，无光脉冲表示0，利用光来表示数据，光的频率为$10^8MHz$，所以光纤通信系统的带宽范围极大
*   传播原理：当光线从高折射率的介质射向低折射率的介质时，其折射角将大于入射角，只要入射角大于某个临界角度，就会出现**全反射(不进行折射，全部反射)**，光就能沿着光纤传输
*   **多模光纤：**将从不同角度入射的多条光线在一根光纤中传输，光源为发光二极管，只适合于近距离传输
*   **单模光纤：**光纤的直径减小到只有一个光的波长时，光线一直向前传播，不会产生多次反射
*   单模光纤的纤芯很细，直径只有几微米，制造成本较高，光源为定向性很好的半导体激光器，适合远距离传输，而且不需要中继器
*   **光纤的特点：**
    *   通信容量非常大
    *   传输损耗小，中继距离长，对远距离传输特别经济
    *   抗雷电和电磁干扰性能好
    *   无串音干扰，保密性好
    *   体积小，重量轻



### 无线介质

*   无线通信广泛应用于移动电话领域，构成蜂窝式无线电话网
*   **无线电波：**无线电波具有较强对穿透力，可以传输很长的距离，**使信号向所有方向传播**，如无线手机通信，无线局域网(WLAN)
*   **微波，红外线，激光：**高带宽的无线通信，都需要发送方和接收方之间存在一条**视线通路**，有很强的方向性，都沿直线传播
*   其中**红外通信和激光通信**把要传输的信号分别转换为各自的信号格式，即红外信号和激光信号，再直接在空间中传播
*   对于**微波通信**，频率较高，频段范围宽，通信信道的容量大，沿直线传播，用中继站来接力
*   卫星通信利用地球同步卫星作为中继站来进行**微波通信**，通信容量大，距离远，覆盖广，**缺点**是保密性差，端到端传播时延长



### 物理层接口的特性

*   物理层的主要任务是**确定与传输媒体的接口有关的一些特性：**
    *   **机械特性：**指明接口所用接线器的形状，尺寸，引脚数目，引脚排列，固定和锁定装置
    *   **电气特性：**指明接口电缆的各条线上出现的电压的范围
    *   **功能特性：**指明线上电平的电压代表的含义
    *   **过程特性/规程特性：**指明对于不同功能的各种可能事件的出现顺序
*   常见的物理层接口标准：EIA RS-232-C，ADSL，SONET/SDH





### 习题

*   传统以太网采用**广播**的方式发送信息，同一时间只允许一台主机发送信息，属于**半双工通信**
*   同轴电缆的带宽更高得益于**高屏蔽性**
*   卫星通信具有**成本高，传播时延长，受气候影响大，保密性差，误码率较高**的特点
*   物理层的**电气特性**规定了信号的电压高低，传输距离



![image-20231018171852465](/Users/coffeeboy/Desktop/考研/assets/image-20231018171852465-7620734.png)



## 物理层设备

### 中继器

*   **原理：**信号再生
*   **功能：**将信号整形放大再转发出去

*   **具有存储转发功能：**代表能连接两个不同的协议
*   中继器只有两个端口，且仅作用于信号的电气部分，而不管是否有错误数据或不适于网段的数据
*   中继器两端的网络部分是网段，工作在物理层，没有存储转发功能，即**不能连接两个具有不同速率的局域网，两端使用同一个协议**
*   **5-4-3规则：**在采用粗同轴电缆的10BASE5以太网规范中，互相串联的中继器不能超过4个，4个中继器串联的5段通信介质中只有3段能挂载计算机，其余2段只能用作扩展通信范围的链路段，不能挂载计算机
*   **放大器：**放大模拟信号，原理为将衰减的信号放大
*   **中继器：**放大数字信号，原理为将衰减的信号整形再生



### 集线器

*   **原理：**信号再生
*   **功能：**将信号整形放大再转发出去
*   **集线器(Hub)：**实质上是一个多端口的中继器，一个端口入，多个端口出
*   如果同时有两个或多个端口输入，则输出发生冲突致使数据无效
*   Hub主要使用双绞线组建共享网络，在交换式网络中，Hub直接与交换机相连
*   由Hub组成的网络是共享式网络，但逻辑上是一个总线网
*   Hub只能工作在**半双工状态**，因此网络的吞吐率受到影响



### 习题

*   **转发器**是物理层设备，不能识别数据链路层的帧，也无寻址功能，只具有放大信号的功能
*   两个网段要能在物理层进行互联要求**数据传输速率相同**，要能在数据链路层互联要求**数据传输速率和数据链路层可以都相同**
*   **放大器**通常用于远距离传输模拟信号，同时也会**放大噪声，引起失真**
*   **网桥**用于连接两个网段以扩展物理网络的覆盖范围
*   **路由器**是网络层的互连设备，可以实现不同网络的互连





# 数据链路层

## 数据链路层的功能

*   **主要作用：**加强**物理层**传输**原始比特流**的功能，将物理层提供的**可能出错的物理连接**改造为**逻辑上无差错的数据链路**，对网络层表现为无差错的链路



### 1.为网络层提供服务

*   对**网络层**而言，数据链路层的基本任务：将源机器中来自网络层的数据传输到目标机器的网络层
*   数据链路层为网络层提供以下服务：
    *   无确认的无连接服务：适用于实时通信，误码率较低的情况，如**以太网**
    *   有确认的无连接服务：适用于误码率较高的情况，如**无线通信**
    *   有确认的面向连接服务：适用于实时性，可靠性较高的情况



### 2.链路管理

*   **链路管理：**数据链路层连接的**建立，维持，释放**过程------主要用于面向连接的服务
*   在多个站点共享同一物理信道的情况下(如局域网)如何在要求通信的站点间分配和管理信道也属于数据链路层的管理



### 3.成帧

*   **成帧：**将**网络层**的分组封装成帧
*   将一段数据的前后分别添加首部和尾部，首部和尾部中含有很多控制信息，**作用是：**确定帧的界限(帧定界)
*   **帧同步：**接收方应能够从接收到的二进制比特流中区分帧的起始和终止
*   **最大传送单元(MTU)：**帧的数据部分的长度上限
*   **透明传输：**不管所传数据是什么样的比特组合，都应能够在链路上传送



### 4.流量控制

*   **流量控制：**限制发送方的数据流量，使其发送速率不超过接收方的接受能力
*   流量控制除了数据链路层之外还有很多高层协议具有这个功能
*   **数据链路层的流量控制**控制的是点到点之间数据链路上的流量，**传输层的流量控制**控制的是端到端之间的流量
*   OSI中，数据链路层具有流量控制的功能，在TCP/IP中，流量控制被移到了传输层



### 5.差错控制

*   **差错控制：**使发送方确定接收方是否正确收到由其发送的数据的方法
*   **位错：**帧中某些位出现了差错，采用循环冗余校验(CRC)方式发现位错，通过自动重传请求(ARQ)方式来重传出错的帧
*   ARQ法只需返回很少的控制信息就可有效地确认所发数据帧是否被正确接收
*   **帧错：**帧的丢失，重复或失序等错误，引入定时器和编号机制来处理帧错



### 习题

*   数据链路层协议的功能：
    *   定义数据格式--成帧
    *   提供结点之间的可靠传输--数据链路管理
    *   控制对物理传输介质的访问--介质访问控制(MAC)子层完成
*   电路管理功能由物理层提供
*   为终端结点隐蔽物理传输的细节是物理层的功能
*   差错控制中的编号机制：为防止接收方不会接收到重复帧
*   差错控制中的定时器：防止帧在传送过程中丢失
*   网际控制报文协议(ICMP)是网络层协议
*   PPP，SLIP，HDLC都是数据链路层协议





## 成帧

*   目的：把比特组合成帧作为单位发送，为了在出错时只重发出错的帧，而不重发全部数据，从而提高效率
*   **组帧：**将网络层递交的分组封装成帧
*   组帧主要解决：帧定界，帧同步，透明传输，组帧时既要加首部也要加尾部
*   一共有四种方法实现组帧



### 1.字符计数法

*   **字符计数法：**在帧**头部**使用一个计数字段来标明帧内字符数(也包括本身)
*   缺点：如果计数字段出错，会失去同步，导致后面的数据全错



### 2.字符填充的首尾定界符法

*   **字符填充法：**用特定字符来定界一帧的开始和结束，控制字符SOH表示帧的开始，EOT表示帧的结束，数据部分包括控制字符，填充转义字符ESC(实现透明传输)



### 3.零比特填充的首尾标志法

*   **零比特填充法：**使用一个特定的比特模式来表示一个帧的开始和结束(比如01111110)，为了防止误判，在信息位中遇到连续的5个‘1’时在其后自动添加一个‘0’，接收方在收到5个连续的‘1’时自动删除后面的‘0’
*   优点：容易由硬件来实现，性能优于字符填充法
*   零比特填充法允许数据帧包含任意个数的比特，也允许每个字符的编码包含任意个数的比特



### 4.违规填充法

*   **违规填充法：**用冗余编码作为控制信号
*   在物理层进行比特编码时，通常采用违规填充法
*   只适用于采用冗余编码的特殊编码环境(局域网IEEE802标准)



### 习题

*   由于**字符计数法中计数字段的脆弱性**和**字符填充法实现上的复杂性和不兼容性**，目前常采用零比特填充法和违规填充法



## 差错控制

*   通常利用**编码控制**来进行差错控制，主要有：自动重传请求ARQ和前向纠错FEC
*   自动重传请求ARQ：接受端检测到差错时，设法通知发送端重发，直到接收到正确的码字为止
*   前向纠错FEC：接收端不但能发现差错，而且能确定比特串的错误位置
*   差错控制分为：检错编码和纠错编码



### 1.检错编码

*   **检错编码**：通过附加冗余位，有效数据变化时，相应的冗余位也发生改变来达到检错的功能
*   常见的检错编码：奇偶校验法和循环冗余码



*   **奇偶校验法**
    *   分为奇校验法和偶校验法
    *   奇校验法：在附加一个校验元后，码长为n的码字中“1”的个数为奇数
    *   偶校验法：在附加一个校验元后，码长为n的码字中“1”的个数为偶数
    *   只能检测**奇数个**位出错的情况



*   **循环冗余法(CRC)**
    *   又称多项式码
    *   给定一个m bit的帧或报文，发送器生成一个r bit的序列，称为**帧检验序列(FCS)**
    *   具体实现过程：
        *   双方先约定一个多项式G(x)，这个多项式的最高位和最低位都为‘1’
        *   特传送数据M，共有m位
        *   G(x)的阶为r，在M的后面加上r个‘0’构成除数X
        *   用除数X除以G(x)得到余数R，如果R=0，则接收方认为无错
    *   循环冗余码(CRC)具有纠错功能，只是数据链路层仅使用了检错功能



### 2.纠错编码

*   最常见的纠错编码是：**海明码**
*   海明码：**看书P69**
*   **海明距：**两个码字对应位置二进制数不同的个数，比如10001和01001，前面2个的值不同，所以码距为2，一个编码集合中，取最小的码距
*   检错d位，码距为d+1，纠错d位，码距为2d+1





### 习题

*   通信信道的噪声分为：热噪声和冲击噪声
*   热噪声是信道固有的，引起的差错是随机差错，可以通过 提高信噪比来降低影响
*   冲击噪声是由外界电磁干扰引起的，引起的差错是突发差错，是引起传输差错的主要原因，无法通过提高信噪比来避免
*   海明码可以纠正一位的错误，可以检测二位的错误
*   海明码满足条件：$n+k<=2^k-1$，n为有效数据的位数，k为校验位的位数
*   CRC校验位的位数是G(x)的最高次数





## 流量控制与可靠传输机制

*   流量控制涉及对链路上的帧的发送速率的控制，以使接收方有足够的缓冲空间来接收每个帧
*   常见的有**停止-等待协议**和**滑动窗口协议**



### 停止-等待协议

*   发送方每发送一帧，都要等待接收方的应答信号，之后才能发送下一帧
*   传输效率很低



### 滑动窗口

*   分为发送窗口$W_T$和接收窗口$W_R$
*   只有接收窗口向前滑动(同时接收方发送了确认帧)时，发送窗口**才有可能**(只有发送方收到确认帧后才一定)向前滑动
*   各种协议的窗口大小：
    *   停止-等待协议：发送窗口为1，接收窗口为1
    *   后退N帧协议：发送窗口>1，接收窗口为1
    *   选择重传协议：发送窗口>1，接收窗口>1，一般发送窗口大小=接收窗口大小
*   窗口的大小在传输过程中是固定的



### 可靠传输机制

*   数据链路层的可靠传输使用**确认和超时重传**来完成
*   将确认捎带在一个回复帧中，称为捎带确认
*   自动重传请求(ARQ)通过接收方请求发送方重传出错的数据帧来回复出错的帧
*   ARQ分为：停止-等待ARQ，后退N帧ARQ(GBN)，选择性重传ARQ(SR)，后两种又称为连续ARQ协议



### 1.GBN(后退N帧)

*   **累计确认：**对某一数据帧的确认就表明该数据帧和此前所有的数据帧都已正确收到
*   GBN中$1<W_T<=2^n-1$，n代表n个比特对序编号

*   弊端：批量重传



#### 1.1发送方

*   **上层的调用**	
    *   上层要发送数据时，发送方先检查发送窗口是否已满，如果**未满**，则产生一个帧并将其发送，如果**已满**，发送方将数据返回上层，要求上层等一会再发(实际实现中，发送方可以缓存这些数据，窗口不满时再发送帧)
*   **收到ACK**
    *   GBN中，对n号帧的确认采用**累计确认**的方式
*   **超时事件**
    *   发送法每发送一个帧，都启动该帧的定时器，如果定时器到还没有收到来自接收方的确认帧则再发送一次



#### 1.2接收方

*   **按序接收**
    *   接收方接收到n号帧，则发送n号确认帧给发送方，并且接收窗口向前移动，等待n+1号帧，如果接收到窗口外的序号帧，都丢弃

*   **重复确认帧**
    *   如果接收方接收的序号帧不是所期待的帧则重复发送上一个确认帧



### 2.SR(选择性重传)

*   SR：只重传出错的数据帧或计数器超时的数据帧
*   一旦接收方怀疑帧出错，就发送一个否定帧NAK给发送方，要求发送方对NAK中指定的帧进行重传
*   SR中$W_T<=2^{n-1}$,发送窗口大小通常等于接收窗口大小



#### 2.1发送方

*   **上层的调用**
    *   从上层收到数据后，SR发送方检查下一下可用于该帧的序号，如果序号位于发送窗口中，则发送数据帧，否则要么将数据缓存，要么返回给上层
*   **收到ACK**
    *   如果收到ACK，发送方将该ACK对应的帧标志为已确认，如果是窗口的下界，则窗口向前移动到具有最小序号的未确认帧处，如果窗口移动了之后窗口内有未发送的序号帧，则发送



#### 2.2接收方

*   **来者不拒**
    *   接收方将确认一个正确接收的帧而**不管其是否按序**，失序的帧会被缓存，并返回确认帧，直到窗口内的所有帧都收到才将一批帧交付给上层，然后向前移动滑动窗口



*   当发送窗口过大时：发送窗口将帧都发出同时打开定时器，接收窗口接收后发出确认帧并将接收窗口向前移，这时如果确认帧都丢失了定时器时间到发送方又发送第一轮的数据而这时接收方已经在接收第二轮的序号帧了，所以无法正常工作



### 习题

*   **信道效率：**又称信道利用率，指发送方在一个发送周期内，有效地发送数据所占用的时间/整个发送周期的时间
*   **发送周期：**发送方从开始发送数据到收到第一个确认帧的时间
*   信道吞吐率 = 信道利用率 * 发送方的发送速率
*   计算最小窗口大小，以最短的帧长来算
*   窗口总数指的是序号最大值，发送窗口大小最大为窗口总数-1
*   信道带宽直接制约数据的传输速率，传输速率一般是小于等于信道带宽
*   选择重传(SR)中：发送窗口大小+接收窗口大小<=$2^n$



![image-20231023185335390](/Users/coffeeboy/Desktop/考研/assets/image-20231023185335390-8058418.png)





## 介质访问控制

*   介质访问控制完成的任务：为使用介质的每个结点**隔离**来自同一信道上**其他结点所传送的信号**，以协调活动结点的传输
*   介质访问控制子层：用来决定**广播信道**中**信道分配**的协议
*   介质访问控制有：
    *   静态划分信道
        *   信道划分介质访问控制
    *   动态划分信道
        *   随机访问介质访问控制
        *   轮询访问介质访问控制



### 1.信道划分介质访问控制

*   **多路复用：**传输介质的带宽超过传输单个信号所需的带宽，**通过在一条介质上同时携带多个传输信号**来提高传输系统的利用率
*   **信道划分的本质 ：**通过**分时，分频，分码**的方法把一条广播信道逻辑上分为几条两个结点之间的子信道
*   信道划分介质访问控制分为：频分多路复用，时分多路复用，波分多路复用，码分多路复用
*   **频分多路复用(FDM)：**
    *   将多路基带信号调制到不同频率载波上，再叠加形成一个复合信号的多路复用技术(共享频率)
    *   每个子信道的带宽可不相同，但总和不超过信道总带宽，在实际中，为了防止子信道之间的干扰，相邻信道之间加入“保护频带”
    *   优点：充分利用了传输介质的带宽，系统效率较高，技术比较成熟实现简单
*   **时分多路复用(TDM)：**
    *   将一个物理信道按时间分成若干时间片，轮流地分配给多个信号使用(共享时间)
    *   每个时刻传送的都是一个设备的信号，一段时刻是按时间分割的多个设备的信号
    *   统计时分多路复用(STDM)：TDM的一种改进，不再使时间片固定，而是动态地分配时间片
*   **波分多路复用(WDM)：**
    *   光的频分多路复用，在一根光纤上传输多种不同波长(频率)的光信号，最后再用波长分解复用器将各路波长分解出来(共享波长)
    *   光波处于频谱的高频段，有很高的带宽
*   **码分多路复用(CDM)：**
    *   采用不同编码来区分各路原始信号(共享频率和时间)
    *   **码分多址(CDMA)：**每个比特时间划分成m个短的时间槽，称为码片，通常m为64或128
    *   每个结点都被分配一个码片序列，比如m为8，A站点的码片序列00011011代表‘1’，反码代表‘0’，每个站点的码片序列必须相互正交，即规格化内积为0(任何一个码片向量与自身的内积为1，与自身的反码内积为-1，与正交的内积为0)
    *   当数据到达接收方时，想要得到哪个站点的数据就乘以那个站点的码片序列，如果结果为1，则数据为1，如果为-1，则数据为0
    *   优点：频谱利用率高，抗干扰能力强，保密性强，语音质量好，减少投资和降低运行成本，主要用于**无线通信系统，移动通信系统**



### 2.随机访问介质访问控制

*   所有用户根据自己的意愿随机发送信息，占用信道全部速率
*   分为ALOHA协议，CSMA协议，CSMA/CD协议，CSMA/CA协议，**核心思想：**胜利者通过争用获得信道，又称争用型协议
*   随机访问介质控制实质上是一种将**广播信道转化为点到点信道的行为**

*   **ALOHA协议：**(不监听)
    *   纯ALOHA协议：
        *   需要发送数据时，不进行检测就发送，在一段时间内未收到确认就认为发生了冲突，等待一段**随机**时间后再发，直到成功
        *   **网络负载G：**T时间内所有站点发送的总帧数
        *   **网络吞吐量S：**T时间内成功发送的平均帧数
        *   纯ALOHA的$S=Ge^{-2G}$，最大为0.184
    *   时隙ALOHA协议：
        *   将时间划分为一段段等长的时隙，只能在每个时隙开始时发送帧
        *   每个帧到达后都要等待一段小于时隙的时间才能再次发送
        *   如果发生冲突，和纯ALOHA一样，等待一段随机时间后在时隙的开始处重发，直到成功
        *   时隙ALOHA的$S=Ge^{-G}$，最大为0.368
*   **CSMA协议：**(监听)
    *   载波监听多路访问(CSMA)在ALOHA的基础上多了一个载波监听装置
    *   分为：1-坚持CSMA，非坚持CSMA，p-坚持CSMA
    *   **1-坚持CSMA：**
        *   监听到信道闲，发送数据的概率为1，监听到信道忙，继续坚持监听信道
        *   传播延迟对该协议影响大，如果A发送数据但是还没到达B，B此时监听信道仍然是闲状态
        *   多个结点监听到信道空闲后同时发送数据
    *   **非坚持CSMA：**
        *   监听到信道闲，发送数据的概率为1，监听到信道忙，放弃监听，随机时间后再监听
        *   用处：降低了多个结点等待信道空闲后同时发送数据导致冲突的概率，但也会增加数据在网络中的延迟时间
    *   **p-坚持CSMA：**
        *   用于时分信道
        *   监听到信道闲，发送数据的概率为p，1-p的概率推迟到下一个时隙再监听，监听到信道忙，等待到下一个时隙开始时监听
        *   概率发送的用处：降低**1-坚持CSMA中**多个结点检测到信道空闲同时发送数据的冲突概率
        *   坚持监听的用处：克服**非坚持CSMA中**由于随机等待而造成的延迟时间长的缺点
*   **CSMA/CD协议：**(碰撞检测)
    *   适用于总线形网络或半双工网络环境，也叫使用于有线连接到局域网
    *   发送前监听到信道闲，则发送数据，发送中检测到碰撞，则停止数据发送，等待随机时间后，重新开始尝试发送数据
    *   **争用期：**以太网端到端往返时间2$\tau$,$\tau$为单程传播时延
    *   **最短帧长：**总线传播时延 * 数据传输速率 * 2
    *   如果发送小于最小帧长的帧，需要在MAC子层中于数据字段的后面加入一个整数字节的填充字段，来保证以太网的MAC帧的长度不小于最短帧长
    *   CSMA/CD还能从冲突中恢复，采用**截断二进制指数退避算法**
        *   确定基本退避时间，一般取$2 \tau$
        *   定义参数k，代表重传次数，k = min[重传次数，10]
        *   从离散的整数集合$[0,1,...,2^k-1]$中取出一个数r，重传所需退避的时间就是(r * 基本退避时间)，也就是$2r\tau$
        *   当k==16时，抛弃此帧并向高层报告出错
    *   协议过程如下：
        *   **准备发送：**适配器从网络层获得一个分组，封装成帧，放入适配器的缓存
        *   **检测信道：**信道空闲，发送数据，信道忙，持续监听
        *   **发送中：**发送中适配器仍持续监听信道
            *   发送成功：在争用期一直未监听到碰撞，则发送成功
            *   发送失败：在争用期监听到碰撞，立即停止发送，适配器执行**指数退避算法**，等待一段时间后再回到检测信道阶段，如果k=16，停止重传并向上报错
*   **CSMA/CA协议：**(碰撞避免)
    *   CSMA/CD协议适用于有线连接到局域网，但是不能适用于无线连接的局域网，原因：
        *   接收信号的强度往往远小于发送信号的强度，且在无线介质上信号强度的动态变化范围很大，因此要实现碰撞检测，硬件花费大
        *   在无线通信中，并非所有的站点都能听见对方，存在“隐蔽站”的问题
    *   因此802.11标准定义了广泛应用于无线局域网的CSMA/CA协议，把碰撞检测改为碰撞避免
    *   碰撞避免：协议的设计要尽量降低碰撞发生的概率
    *   该协议每次发送帧会完整的发送
    *   802.11使用链路层确认/重传(ARQ)方案，即站点每通过无线局域网发送完一帧，在收到对方确认后才能继续发生下一帧
    *   收到确认后需要等待一段时间才能发送下一帧，这段时间称为**帧间间隔**，帧间间隔的长短取决于帧的类型，分为：
        *   SIFS(短IFS)：最短的IFS，使用SIFS的帧类型有：ACK帧，CTS帧，分片后的数据帧，所有回答AP探询的帧
        *   PIFS(点协调IFS)：中等长度的IFS，在PCF操作中使用
        *   DIFS(分布式协调IFS)：最长的IFS，用于异步帧竞争访问的时延
    *   只有检测到信道空闲且要发送的帧是第一个数据时才不使用退避算法，以下情况必须使用退避算法：
        *   在发送第一个帧前检测到信道忙
        *   每次重传
        *   每次成功发送后要发送下一帧
    *   协议过程如下：
        *   站点发送第一个数据，如果检测到信道闲，则在等待时间DIFS后，就发送整个数据帧
        *   如果检测到信道忙，执行CSMA/CA退避算法，选择一个随机回退值，一旦检测到信道忙，则计数器不变，只要信道空闲，计时器就倒计时
        *   当退避计时器减到0时(这时信道只能是空闲的)，站点就发送整个帧并等待确认
        *   若收到确认，则知道已发送的帧被成功接收，如果发送第二个帧，则从第二步开始，执行退避算法
        *   如果在规定时间内也就是重传计时器到0时没有收到ACK，就必须重传
    *   **为了解决“隐蔽站”问题：**
        *   源站在发送数据之前先**广播一个很短的请求发送RTS控制帧**，包含源地址，目的地址，这次通信所持续的时间
        *   若信道空闲，目的地址**广播一个允许发送CTS控制帧**，包含这次通信所需的时间
        *   其他站在收到CTS后，在CTS帧内指明的时间内将抑制发送
        *   CTS帧的目的：
            *   给源站明确的发送许可
            *   指示其他站点在预约期内不要发送
        *   只有当数据帧长度超过某一数值时，使用RTS和CTS帧才比较有利



*   CSMA/CD和CSMA/CA主要有如下区别：
    *   CSMA/CD可以检测冲突，但无法避免，CSMA/CA无法在发送数据的同时检测碰撞，只能尽量避免碰撞
    *   **传输介质不同：**CSMA/CD用于总线形以太网，CSMA/CA用于无线局域网802.11a/b/g/n
    *   **检测方式不同：**CSMA/CD通过电缆中的电压变化来检测，CSMA/CA采用能量检测，载波检测，能力载波混合检测



### 轮询访问：令牌传递协议

*   轮询访问中，用户不能随机地发送信息，而要通过一个集中控制的监控站，以循环方式轮询每个结点，再决定信道的分配
*   令牌传递协议：一个令牌沿着环形总线在各结点间一次传递，令牌是一个特殊的MAC控制帧，本身并不包含信息，仅控制信道的使用
*   当站点希望传输帧时，必须等待令牌，一旦收到令牌则立即启动发送帧，包含目的站点地址
*   协议过程如下：
    *   网络空闲时，环路中只有令牌帧在循环传递
    *   令牌传送到一个需要发送帧的站点时，该站点就修改令牌的一个标志位，并在令牌中附加自己需要传输的数据，将令牌变成一个数据帧，然后将这个数据帧发送
    *   数据帧沿着环路传输，接收到的站点一边转发数据，一边查看帧的目的地址，将目的地址与自身地址进行匹配，如果相同，接收站就**复制**该数据帧
    *   当数据帧到达源站点，通过检验返回的帧来查看数据传输过程中是否出错，有错就重传
    *   源站点传送玩数据之后，重新产生一个令牌，并传递给下一个站点
*   轮询介质访问控制适用于负载很高的广播信道(多个结点在同一时刻发送数据概率很大的信道)